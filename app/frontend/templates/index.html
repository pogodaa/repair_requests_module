<!-- app/frontend/templates/index.html -->
{% extends "base.html" %}
{% block title %}–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç{% endblock %}
{% block header %}–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç{% endblock %}
{% block content %}

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th> <!-- ‚Üê –ù–û–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
      <th>–¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</th>
      {% if user_role != "client" %}
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for req in requests %}
    <tr>
      <td>{{ req.requestID }}</td>
      <td>{{ req.startDate }}</td> <!-- ‚Üê –î–ê–¢–ê –°–û–ó–î–ê–ù–ò–Ø -->
      <td>{{ req.climateTechType }}</td>
      <td>{{ req.requestStatus }}</td>
      <td>
        {% if req.masterID %}
          {{ get_user_fio(req.masterID) }}
        {% else %}
          <em>–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</em>
        {% endif %}
      </td>
      <td>
        {% if user_role == "specialist" and req.masterID == current_user_id %}
          <a href="/comment/{{ req.requestID }}" class="button">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</a>
        {% elif user_role == "operator" %}
          <a href="/edit/{{ req.requestID }}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        {% elif user_role in ["manager", "admin"] %}
          <a href="/assign/{{ req.requestID }}" class="button">–ù–∞–∑–Ω–∞—á–∏—Ç—å</a>
          <a href="/edit/{{ req.requestID }}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        {% endif %}
      </td>
    </tr>
    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –∑–∞—è–≤–∫–æ–π -->
    {% if req.comments %}
      <tr>
        <td colspan="6" style="padding-top: 0; border-top: none;"> <!-- colspan=6 (–±—ã–ª–æ 5) -->
          <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-top: 8px; font-size: 14px;">
            <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</strong>
            <ul style="margin: 8px 0 0; padding-left: 20px;">
              {% for comment in req.comments %}
                <li>
                  <em>{{ get_user_fio(comment.masterID) }}</em>: 
                  "{{ comment.message }}"
                  {% if comment.created_at %}
                    <small style="color: #6c757d;">({{ comment.created_at }})</small>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </div>
        </td>
      </tr>
    {% endif %}
    {% endfor %}
  </tbody>
</table>
{% endblock %}